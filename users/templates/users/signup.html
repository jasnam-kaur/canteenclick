{% extends 'base_auth.html' %}

{% block title %}Sign Up - CanteenClick{% endblock %}

{% block content %}
<h2 class="card-title text-center mb-4">Create Your Account</h2>

{% if form.non_field_errors %}
<div class="alert alert-danger" role="alert">
    <ul class="mb-0" style="padding-left: 1.2em;">
        {% for error in form.non_field_errors %}
        <li>{{ error }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<form method="POST">
    {% csrf_token %}

    <div class="mb-3">
        <label for="{{ form.username.id_for_label }}" class="form-label">Username</label>
        <input type="text" name="username" class="form-control" id="{{ form.username.id_for_label }}"
            value="{{ form.username.value|default:'' }}" required>
        {% if form.username.errors %}
        <div class="form-field-error">{{ form.username.errors }}</div>
        {% endif %}
    </div>

    <div class="mb-3">
        <label for="{{ form.password1.id_for_label }}" class="form-label">Password</label>
        <div class="password-wrapper">
            <input type="password" name="password1" class="form-control"
                id="{{ form.password1.id_for_label }}" required>
            <span class="toggle-icon" id="toggle-password-1">
                <i class="bi bi-eye"></i>
            </span>
        </div>
        {% if form.password1.errors %}
        <div class="form-field-error">{{ form.password1.errors }}</div>
        {% endif %}
    </div>

    <div class="mb-3">
        <label for="{{ form.password2.id_for_label }}" class="form-label">Confirm Password</label>
        <div class="password-wrapper">
            <input type="password" name="password2" class="form-control"
                id="{{ form.password2.id_for_label }}" required>
            <span class="toggle-icon" id="toggle-password-2">
                <i class="bi bi-eye"></i>
            </span>
        </div>
        {% if form.password2.errors %}
        <div class="form-field-error">{{ form.password2.errors }}</div>
        {% endif %}
    </div>

    <button type="submit" class="btn btn-primary btn-lg w-100 mt-3">Create Account</button>
</form>

<div class="text-center mt-3">
    <hr class="my-3">
    Already have an account? <a href="{% url 'login' %}" class="fw-bold text-accent">Log In</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    function togglePasswordVisibility(toggleBtnId, inputId) {
        const togglePassword = document.getElementById(toggleBtnId);
        const passwordInput = document.getElementById(inputId);
        const icon = togglePassword.querySelector('i');

        if (togglePassword && passwordInput) {
            togglePassword.addEventListener('click', function () {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);

                if (type === 'password') {
                    icon.classList.remove('bi-eye-slash');
                    icon.classList.add('bi-eye');
                } else {
                    icon.classList.remove('bi-eye');
                    icon.classList.add('bi-eye-slash');
                }
            });
        }
    }
    
    // We use Django's template tags to get the *exact* ID of the fields
    togglePasswordVisibility('toggle-password-1', '{{ form.password1.id_for_label }}'); 
    togglePasswordVisibility('toggle-password-2', '{{ form.password2.id_for_label }}');
</script>
{% endblock %}