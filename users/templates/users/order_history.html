<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Order History</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f9f9f9; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: middle; }
        th { background-color: #f4f4f4; }
        .nav-links { margin-bottom: 20px; }
        
        /* Status Styles */
        .status-completed { color: #28a745; }
        .status-cancelled { color: #dc3545; }
        .status-active { color: #007bff; font-weight: bold; }
        
        /* --- NEW: Action Button Styles --- */
        .action-links {
            display: flex;
            flex-direction: column;
            gap: 8px; /* Adds space between buttons */
        }
        .action-btn {
            display: block;
            padding: 5px 10px;
            text-decoration: none;
            border-radius: 4px;
            font-size: 0.9em;
            text-align: center;
            color: white;
            border: none;
            cursor: pointer;
        }
        .action-btn.track { background-color: #17a2b8; } /* Teal */
        .action-btn.view-qr { background-color: #6c757d; } /* Gray */
        .action-btn.cancel { background-color: #dc3545; } /* Red */
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-links">
            <a href="{% url 'core:home' %}">&larr; Back to Home</a>
        </div>
        
        <h1>My Orders</h1>
        
        {% if messages %}
            <ul class="messages" style="list-style: none; padding: 0;">
                {% for message in messages %}
                    <li style="padding: 10px; background: #d4edda; color: #155724; border-radius: 5px; margin-bottom: 10px;">
                        {{ message }}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}

        {% if orders %}
            <table>
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Placed At</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Action</th> </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>#{{ order.id }}</td>
                        <td>{{ order.created_at|date:"d M Y, H:i" }}</td>
                        <td>â‚¹{{ order.total_price }}</td>
                        <td>
                            {% if order.status == 'Completed' %}
                                <span class="status-completed">Completed</span>
                            {% elif order.status == 'Cancelled' %}
                                <span class="status-cancelled">Cancelled</span>
                            {% else %}
                                <span class="status-active">{{ order.get_status_display }}</span>
                            {% endif %}
                        </td>
                        
                        <td class="action-links">
                            {% if order.status == 'Pending' or order.status == 'Preparing' or order.status == 'Ready for Pickup' %}
                                
                                <a href="{% url 'live-track-order' order.id %}" class="action-btn track">Track Live</a>
                                
                                <a href="{% url 'order-complete' order.order_id %}" class="action-btn view-qr">View QR</a>
                                
                                {% if order.status == 'Pending' %}
                                    <a href="{% url 'user-cancel-order' order.id %}" class="action-btn cancel">Cancel Order</a>
                                {% endif %}

                            {% else %}
                                -
                            {% endif %}
                        </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>You have no orders.</p>
        {% endif %}
    </div>
</body>
</html>