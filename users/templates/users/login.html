{% extends 'base_auth.html' %}

{% block title %}Login - CanteenClick{% endblock %}

{% block content %}
<h2 class="card-title text-center mb-4">Login</h2>

{% if form.non_field_errors %}
    <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
            {{ error }}
        {% endfor %}
    </div>
{% endif %}
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
{% endif %}

<form method="POST">
    {% csrf_token %}
    
    <div class="mb-3">
        <label for="{{ form.username.id_for_label }}" class="form-label">Username</label>
        <input type="text" name="username" class="form-control" id="{{ form.username.id_for_label }}" 
               value="{{ form.username.value|default:'' }}">
        {% if form.username.errors %}
            <div class="form-field-error">{{ form.username.errors.as_text }}</div>
        {% endif %}
    </div>

    <div class="mb-3">
        <label for="id_password" class="form-label">Password</label>
        <div class="password-wrapper">
            <input type="password" name="password" class="form-control" id="id_password">
            <span id="toggle-password" class="toggle-icon">
                <i class="bi bi-eye"></i>
            </span>
        </div>
        {% if form.password.errors %}
            <div class="form-field-error">{{ form.password.errors.as_text }}</div>
        {% endif %}
    </div>

    <div class="form-check mb-3">
        <input type="checkbox" name="remember_me" class="form-check-input" id="remember_me">
        <label class="form-check-label" for="remember_me">Remember Me</label>
    </div>

    <button type="submit" class="btn btn-primary btn-lg w-100">Login</button>
</form>

<div class="text-center mt-3">
    <a href="#" class="small">Forgot Password?</a> 
    <hr class="my-3">
    Don't have an account? <a href="{% url 'signup' %}" class="fw-bold text-accent">Sign Up</a>
</div>
{% endblock %}

{% block scripts %}
<script>
    const togglePassword = document.getElementById('toggle-password');
    const passwordInput = document.getElementById('id_password');
    const icon = togglePassword.querySelector('i');

    togglePassword.addEventListener('click', function () {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        
        if (type === 'password') {
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
        } else {
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
        }
    });
</script>
{% endblock %}